# Avito Parser with FastAPI and Selenium

## Описание

Этот проект реализует сервис на основе FastAPI для парсинга количества объявлений на сайте Avito по заданным поисковым запросам и регионам. Сервис использует Selenium для парсинга страниц и SQLAlchemy для работы с базой данных. Проект также использует Docker и Docker Compose для контейнеризации.

## Основные функции

- **Добавление поискового запроса**: Через эндпоинт `/add/` можно добавить новый поисковый запрос и регион для мониторинга количества объявлений.
- **Получение статистики**: Через эндпоинт `/stat/{id}` можно получить статистику по количеству объявлений за определенный период времени.
- **Планировщик задач**: Сервис автоматически обновляет количество объявлений для заданных запросов с использованием планировщика APScheduler.

## Структура проекта

- `main.py`: Основной файл приложения FastAPI.
- `models.py`: Определение моделей данных с использованием SQLAlchemy.
- `database.py`: Настройки подключения к базе данных.
- `parsers.py`: Функции парсинга страниц с использованием Selenium.
- `scheduler.py`: Настройки и запуск планировщика задач.
- `Dockerfile`: Файл для сборки Docker-образа приложения.
- `docker-compose.yml`: Файл для управления контейнерами с использованием Docker Compose.

## Установка и запуск

### Предварительные требования

- Docker и Docker Compose должны быть установлены на вашей машине.

### Запуск проекта

1. Клонируйте репозиторий на вашу локальную машину:

   ```bash
   git clone https://github.com/your-username/avito-parser.git
   cd avito-parser

2. Постройте и запустите контейнеры с помощью Docker Compose:

   ```bash
    docker-compose up --build
   ```
   
3. После сборки контейнеров, приложение будет доступно по адресу:

   ```bash
   http://localhost:8000
   ```
   
4. Использование API

Добавление нового запроса
POST /add/

Добавляет новый поисковый запрос и регион для отслеживания.

Пример запроса:

```bash
curl -X POST "http://localhost:8000/add/" -d "query=iphone 13&region=kaliningrad"
```

Пример ответа:

```json
{
  "id": 1
}

```

Получение статистики
GET /stat/{id}

Возвращает статистику по количеству объявлений для заданного запроса.

Пример запроса:

```bash
curl -X GET "http://localhost:8000/stat/1"
```

Пример ответа:

```json
{
  "query": "iphone 13",
  "region": "kaliningrad",
  "statistics": [
    {
      "timestamp": "2024-08-16T12:34:56Z",
      "count": 237
    },
    ...
  ]
}
```

## Технические детали

FastAPI: Основной веб-фреймворк для создания API.
SQLAlchemy: Используется для взаимодействия с базой данных.
Selenium: Используется для парсинга веб-страниц.
Gunicorn: WSGI сервер для запуска FastAPI в продакшене.
APScheduler: Планировщик задач для периодического обновления данных.


## Disclaimer

Для успешного парсинга страниц важно убедиться, что chromedriver совместим с архитектурой вашего процессора (например, ARM64 для Apple Silicon).
Использование Docker обеспечивает изоляцию окружения и упрощает развертывание приложения.